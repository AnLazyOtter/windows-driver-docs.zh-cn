---
title: 筛选数据
description: 为了优化数据吞吐量和电池寿命，传感器设备必须应用筛选器条件的数据更新事件，以便它们仅在需要时引发。
ms.assetid: EDABA09D-2C46-4546-9429-CF6DEFBF69C4
keywords:
- 更改敏感度
- 传感器变化敏感度
- 阈值
- 传感器的阈值
- CS
- 当前报告间隔
- 传感器当前报告间隔
- CRI
- 数据更新事件
- 传感器事件
- 传感器事件
- 筛选数据
- 数据筛选
ms.date: 07/20/2018
ms.localizationpriority: medium
ms.openlocfilehash: a691901336418a7cc14645cddbae7fc810df1832
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "63362292"
---
# <a name="filtering-data"></a>筛选数据


为了优化数据吞吐量，传感器设备必须应用筛选器条件的数据更新事件，以便它们仅在需要时引发。 此筛选将导致较低的 CPU 利用率 （由于减少了的传感器吞吐量） 和更少的功耗 （无论是传感器和 CPU）。

有两个值 （或属性） 的支持传感器设备的筛选条件。 第一个是当前报表时间间隔内 (CRI) 和第二个是变化敏感度 (CS，也称为阈值)。 两个属性可以由传感器的 Win32 应用程序设置。

当前报告间隔是以毫秒为单位的数据更新的客户端希望接收有意义的更改发生时之间的最短期限。 变化敏感度是用来指定有意义的更改的值 （或百分比）。

因此，气象站应用程序可能会指定当前报告间隔 (CRI) 为 60000 温度传感器 （或一分钟）。 和温度传感器会要求变化敏感度的值 （而不是百分比表示）。 例如，如果此温度传感器返回摄氏度，而更改敏感度值温度为 2.0，此特定传感器将只会引发数据更新事件时，温度，按增大或减小，2.0 摄氏度通过请求的报表时间间隔内 （在此情况下，一分钟）。

环境光线传感器 (ALS) 是传感器的需要更改的敏感度以指定为百分比的示例。 例如，如果 Illuminance 的更改敏感度值是 2.0，此传感器将解释为百分比值和只会引发数据更新事件时的 LUX 值已删除或增加 2%。

## <a name="terminologies-related-to-filtering-criteria"></a>与筛选条件相关的术语

| 术语 | 含义 |
|------|---------|
| 当前报告间隔 (CRI) | 表示为以毫秒为单位的客户端希望接收数据的期限 （而不是频率） 更新时进行在数量级上有意义的更改速率。<br><br>如果有意义的更改 （在传感器测量的现象） 发生了此字段表示为事件之间的最短期限。 该期间将不同但永远不会是短于此，基于有意义的更改的匹配项。<br><br>此值是每个传感器。|
| 更改敏感度 (CS) | 构成的有意义的更改的测量现象中的变化。 这可以表示为线性量值 (例如，用于加速感应器读取的.05 G) 或非线性量值 （环境光线传感器读取的 5%)。<br><br>此值是每个传感器的数据字段。|
| 有效的当前报告间隔 (E CRI) | RI 值计算在任意给定时间的时间和设备驱动程序用来筛选基于的数据更新事件传递：<ul><li>RI 值 （如果有） 由客户端设置</li><li>默认 RI，即设备 （如驱动程序，因为默认行为的实现）</li><li>硬件能够遵守请求的 RI</li></ul><br>此值是每个传感器。|
| 有效的更改敏感度 (E-CS) | CS 值计算在任意给定时间的时间和设备驱动程序用来筛选基于的数据更新事件传递：<ul><li>CS 值 （如果有） 由客户端设置</li><li>设备 （如驱动程序，因为默认行为的实现） 默认 CS</li><li>硬件能够遵守请求的 CS</li></ul><br>此值是每个传感器的数据字段。|

## <a name="change-sensitivity"></a>更改敏感度
可能的完整列表更改敏感度值中介绍了每个传感器[传感器阈值](sensor-thresholds-v2.md)此文档的部分。

## <a name="current-report-interval-recommended-defaults"></a>推荐的默认值的当前报告间隔
下表列出了建议的当前报表时间间隔 (CRI) 默认值。

| 传感器类型               | 推荐的默认报表时间间隔内  |
|---------------------------|--------------------------------------|
| 加速计             | 100                                  |
| 活动检测        | 5000                                 |
| 环境光线传感器      | 1000                                 |
| 气压计                 | 1000                                 |
| 自定义传感器             | 不可用                                  |
| 地磁方向   | 100                                  |
| 重力向量            | 100                                  |
| 陀螺测试仪                 | 100                                  |
| 线性加速感应器      | 100                                  |
| 磁力仪              | 100                                  |
| Orientation               | 50                                   |
| 步程计                 | 1000                                 |
| 邻近感应                 | 100*                                 |
| 相对方向      | 100                                  |
| 简单设备方向 | 200*                                 |

(*)邻近和简单的设备方向传感器必须定期报告示例读数。 相反，这些传感器报告数据，此类扩展时读取已更改。 这些传感器的报告间隔值表示的最大可以用传感器报告示例读取的时间量。

## <a name="change-sensitivity-recommended-defaults"></a>推荐的默认值的变化敏感度
下表列出了建议的更改敏感度 (CS) 默认值。

|  传感器类型              | 建议使用默认变化敏感度 |
|---------------------------|----------------------------------------|
| 加速计             | 0.02 G                                 |
| 活动检测        | 0 （无订阅的活动）             |
| 环境光线传感器      | 25 %lux 更改                         |
| 气压计                 | 0.001 栏                              |
| 自定义传感器             | 不可用                                    |
| 地磁方向   | 10.0 度                           |
| 重力向量            | 10.0 度                           |
| 陀螺测试仪                 | 0.50 度 / 秒                |
| 线性加速感应器      | 0.02 G                                 |
| 磁力仪              | 5.0 microtesla                         |
| Orientation               | 10.0 度                           |
| 步程计                 | 10000 的步骤                            |
| 邻近感应                 | 邻近更改                    |
| 相对方向      | 10.0 度                           |
| 简单设备方向 | 在方向更改                  |

## <a name="effective-current-report-interval-cri-and-change-sensitivity-cs"></a>有效的当前报告间隔 (CRI) 和变化敏感度 (CS)

当前报表时间间隔 (CRI) 和给定的传感器的更改敏感度 (CS) 属性，可以设置多个应用程序。 当应用程序配置冲突 （例如请求不同的更改敏感度值或不同的报表的时间间隔的两个应用程序） 时，传感器类扩展确定的最相关的 CS 和 CRI，将发送到该驱动程序。 传感器类扩展提供给驱动程序的 CS 和 CRI 值引用作为有效当前报表的时间间隔内 (E CRI) 和有效更改的敏感度 (E-CS)。

以下函数调用的传感器类扩展，启动/停止传感器、 报告示例读取或设置电子 CRI 和 E CS。

| 感兴趣的事件          | 事件处理程序活动                                           |
|----------------------------|--------------------------------------------------------------------|
| EvtSensorStart             | 启动传感器                                                  |
| EvtSensorStop              | 停止传感器                                                   |
| EvtSensorSetDataInterval   | 设置当前报告间隔                                    |
| EvtSensorGetDataInterval   | 获取当前报告间隔                                    |
| EvtSensorSetDataThresholds | 设置当前的更改敏感度 (threshold) 值              |
| EvtSensorGetDataThresholds | 获取当前的更改敏感度 (threshold) 值              |
| SensorsCxSensorDataReady   | 驱动程序报告读取至传感器类扩展的示例 |

## <a name="filtering-data-update-events-by-evaluating-the-effective-cri-and-cs-values-e-cri-e-cs"></a>通过计算有效的 CRI 和 CS 值 (电子 CRI，E CS) 的筛选数据更新事件

当前的 E CRI 和 E CS 值在设置后，传感器设备将使用这些值来筛选连接的客户端应用程序引发的事件。 这些值进行比较的"current"的数据值和以前的数据值之间的差异。 如果 E CS 值超出了某个时间段等于或大于电子 CRI，然后，只有在此时，应引发数据事件。 唯一的例外是初始读取本文档后面的部分中所述的示例。

没有筛选作为筛选条件中使用的当前电子 CRI 和当前 E CS 值，将引发的事件的事件的基本原则。 这些筛选的值进行比较以确定应通过调用 SensorsCxSensorDataReady 引发事件时的当前数据值和以前的数据值之间的差异。 如果量值阈值 (E-CS) 具有已超过引发等于或大于时间阈值 (E-CRI)，然后，才应将数据事件的时间段。 建议引发数据事件在驱动程序启动时，以便客户端可以接收正确的通知获取的初始值。 除了此实现应唤醒 CPU 通常比请求的报表时间间隔，以节省电量。

下图演示了如何时间筛选的原始传感器数据以确定应引发数据事件时评估。

![时间筛选传感器数据](images/cri-cs.png)

在上图中，关系图的下半部分中的红色数据表示的原始传感器数据。 绿线表示将返回给客户端的轮询数据 （一个的多种方式实现此行为） 的数据和"<font color="red">__X__</font>"的值表示数据的事件触发时。 蓝线是 E CS 边界 （+ /-相对于最后一个数据事件值 E CS) 的阈值。

通过实现此事件筛选逻辑，可以极大地减少了更新的事件，数据和应用程序可以仍获取有意义发生更改时通知中的传感器数据。

## <a name="streaming"></a>Streaming

流式处理是按固定间隔将允许到报表示例读数传感器驱动程序的模式。 此模式可能由应用程序，用于接收常量数据的流。

### <a name="general-case"></a>一般情况下

传感器，除外，下面所述的传感器必须报告读取在每个电子 CRI，如果类扩展设置的所有传感器 CS 值为 0 的一个示例。

### <a name="exceptions"></a>Exceptions

* 如果 PKEY_SensorData_SubscribedActivityStates 设置为 0，活动检测传感器必须未报告任何活动的更改。 相反，传感器类扩展会将 PKEY_SensorData_ActivityStream 体时需要流到传感器。
* 接近传感器和简单设备方向不支持流式处理。
* 接近传感器必须仅报告读取邻近检测状态已更改时的示例 (之间检测到并且未检测到，反之亦然) 必须遵守的初始示例读取除外。
* 简单的设备方向传感器必须仅报告读取时的设备方向已更改象限除了初始示例读取必须考虑的一个示例。

## <a name="initial-sample-reading"></a>初始示例读取

当通过调用 EvtSensorStart 启动传感器驱动程序时，驱动程序必须报告通过 SensorsCxSensorDataReady 调用一个传感器示例，只要传感器硬件已准备好发送有效的数据。 初始示例读取必须发送到此类扩展而不考虑报表时间间隔内，或更改敏感度设置。 应用程序将初始示例用作基础读取比较的示例。
此规则适用于所有传感器。


## <a name="device-runtime-optimizations-for-data-filtering"></a>设备运行时优化的数据筛选

本部分介绍开发传感器驱动程序时应考虑的几个运行时优化。

### <a name="support-interrupts"></a>支持中断

您的驱动程序应依赖于中断而不是轮询设备。 这将导致性能和电源管理改进。 这些改进包括以下内容。

1.  你的设备可以输入基于当前的更改敏感度和报告间隔低功率状态。
2.  使用中断会减少驱动程序和传感器固件中的不必要的代码执行。
3.  使用中断会减少总线活动。

**注意**：如果驱动程序依赖于中断，但当前报告间隔和变化敏感度逻辑存在驱动程序中，该驱动程序将可能收到大量的数据更新之间的中断。 因此，该驱动程序可能需要禁用 （或屏蔽） 中断当前报告间隔过期之前。


### <a name="move-change-sensitivity-support-to-the-device"></a>将更改敏感度支持移动到设备

如果您的传感器硬件或固件，支持你应使用此功能来支持变化敏感度的阈值检测。 通过将支持移动到该设备，然后对相应中断作出响应，你可以减少在您的驱动程序中的处理开销。

### <a name="move-report-interval-support-to-the-devices"></a>将报表时间间隔内支持移动到设备

如果您的传感器硬件或固件，支持报表时间间隔内的概念应该使用此功能。

如果您的传感器不提供本机报表时间间隔内支持，请考虑禁用对当前报表时间间隔内的子集的中断。 然后，在此时间过后，检索当前的设备数据。

## <a name="related-topics"></a>相关主题
[传感器地理位置驱动程序示例](https://docs.microsoft.com/windows-hardware/drivers/gnss/sensors-geolocation-driver-sample)

