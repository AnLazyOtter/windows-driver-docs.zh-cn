---
title: 篡改数据
description: 篡改数据
ms.assetid: 277395b9-b770-45b4-8f4c-cad8b684ca44
keywords:
- 威胁建模 WDK 文件系统、 数据篡改
- 安全威胁模型 WDK 文件系统、 数据篡改
- 数据篡改 WDK 文件系统
- 篡改数据 WDK 的文件系统
- 缓冲区 WDK 文件系统
- Ioctl WDK 文件系统
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 78164b0adb8e21f166845a785b84bfab444cd94a
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/25/2019
ms.locfileid: "67371301"
---
# <a name="tampering-with-data"></a>篡改数据


## <span id="ddk_tampering_with_data_if"></span><span id="DDK_TAMPERING_WITH_DATA_IF"></span>


数据篡改是驱动程序，请威胁但严重威胁的文件系统和文件系统筛选器驱动程序。 对于所有驱动程序，没有一个潜在的威胁，用户模式和内核模式组件之间共享任何控制结构可以修改由用户模式组件正在使用中的内核模式组件。 文件系统和筛选器驱动程序不特别容易受到此类攻击，因为它们具有方法的强依赖\_既不传输的数据类型直接访问通过其虚拟地址的用户缓冲区。 快速 I/O 直接访问原始用户模式缓冲区。 这样做的风险是： 驱动程序可能正在使用此数据时应用程序正在修改数据。 通常情况下，驱动程序将尝试验证数据，对此保护。 但是，数据验证仅适用于已验证后，不能更改数据。

对于文件系统和文件系统筛选器驱动程序，有许多 IOCTL 和 FSCTL 用于用户模式应用程序和各种内核模式驱动程序之间传输信息的操作。 此外，它是相当常见的是此类驱动程序具有专用的 IOCTL 和 FSCTL 操作还用户模式服务和其内核模式驱动程序之间传输控制和数据的信息。

在这种设计模型中固有为假设仅驱动程序的服务或应用程序将充分利用其接口。 此类的设计和实现正面临风险原因如下：

-   恶意应用程序无法将有效的缓冲区发送到该驱动程序，并随后修改数据以尝试探测并查找驱动程序的弱点。

-   控制应用程序中的故障可能会导致控件缓冲区变得无效的数据内容。 例如，基于堆栈的控制区域可能会变为无效，如果异常已更改的控制流，从而导致重复使用的堆栈区域。

防止这种类别的问题需要在实现方面的持续警戒。 缓冲区必须位于之前要验证的非易失性内存 （仅限内核的或只读内存）。 如果缓冲区包含对任何其他缓冲区或控制结构的引用，它们也必须位于非易失性内存之前进行验证。

开发人员还应了解使用该 IOCTL **FastIoDeviceControl**调度传入原始用户缓冲区的数据。 因此为 Ioctl 实现快速 I/O 版本的驱动程序应采取适当措施来防止出现问题。

请注意，验证数据本身是不够的。 例如，成功调用[ **ProbeForWrite** ](https://docs.microsoft.com/windows-hardware/drivers/ddi/content/wdm/nf-wdm-probeforwrite)可能表示一个缓冲区就是有效的但应用程序地址空间中的后续更改可能会导致该状态发生更改。 应用程序无法终止，例如，在实际直接使用缓冲区的驱动程序之前。 因此，该驱动程序必须防止应用程序的地址空间内的任何更改。 通常这是使用结构化异常处理使用 **\_\_尝试**并 **\_\_除**围绕访问用户缓冲区的任何代码直接地址。

 

 




