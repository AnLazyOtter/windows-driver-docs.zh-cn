---
title: 筛选器管理器概念
description: 筛选器管理器概念
ms.assetid: 5b11671f-02fd-4d0e-8199-c345bbf2591c
keywords:
- 筛选器管理器 WDK 文件系统微筛选器，关于筛选器管理器
- 海拔的地区 WDK 文件系统微筛选器
- 筛选器管理器 WDK 文件系统微筛选器，体系结构
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 823a62f6203bc8b4713b9f478ff7dbde62d5f8b9
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "63372731"
---
# <a name="filter-manager-concepts"></a>筛选器管理器概念


## <span id="ddk_returning_status_from_a_minifilter_driverentry_routine_if"></span><span id="DDK_RETURNING_STATUS_FROM_A_MINIFILTER_DRIVERENTRY_ROUTINE_IF"></span>


筛选器管理器随 Windows，但仅当加载微筛选器驱动程序时，它变为活动状态。 筛选器管理器将附加到目标卷的文件系统堆栈。 微筛选器驱动程序将附加到文件系统堆栈间接通过微筛选器驱动程序选择要筛选的 I/O 操作的筛选器管理器中注册。

相对于其他筛选器驱动程序在文件系统 I/O 堆栈中的旧的筛选器驱动程序的位置是由其加载顺序组确定在系统启动时。 例如，防病毒筛选器驱动程序应高于堆栈中复制筛选器驱动程序，以便它可以检测病毒，并对文件进行杀毒之前其复制到远程服务器。 因此，在 FSFilter 复制组中的筛选器驱动程序之前加载 FSFilter 防病毒软件加载顺序组中的筛选器驱动程序。 每个加载顺序组具有相应的系统定义的类和筛选器驱动程序的 INF 文件中使用类 GUID。

旧的筛选器驱动程序，如按特定顺序将附加微筛选器驱动程序。 但是，附件的顺序由调用的唯一标识符*海拔高度*。 调用微筛选器驱动程序在特定卷上特定海拔高度的附件*实例*微筛选器驱动程序。

微筛选器驱动程序的海拔高度可确保微筛选器驱动程序的实例始终处于加载状态在适当的位置相对于其他微筛选器驱动程序实例，并确定在其中筛选器管理器调用微筛选器驱动程序添加到的顺序处理 I/O。 等级由 Microsoft 分配和管理。

下图显示了与筛选器管理器的简化的 I/O 堆栈和三个微筛选器驱动程序。

![使用筛选器管理器和三个微筛选器驱动程序说明的简化的 i/o 堆栈的关系图](images/filter-manager-architecture-1.gif)

基于 IRP 的 I/O 操作，以及快速 I/O 和文件系统筛选器 (FSFilter) 回调的操作，可以筛选微筛选器驱动程序。 对于每个 I/O 操作它选择筛选器，可以注册在微筛选器驱动程序[preoperation 回调例程](writing-preoperation-and-postoperation-callback-routines.md)，和 / 或 postoperation 回调例程。 在处理 I/O 操作时，筛选器管理器注册该操作的每个微筛选器驱动程序调用的相应回调例程。 该回调例程返回时，筛选器管理器将调用注册操作的下一步微筛选器驱动程序的相应回调例程。

例如，假设注册为同一个 I/O 操作上图中的所有三个微筛选器驱动程序，筛选器管理器将调用其 preoperation 回调例程海拔高度的顺序从最高到最低 (A，B，C)，然后将 I/O 请求转发到下一步低驱动程序进行进一步处理。 筛选器管理器接收时完成的 I/O 请求，它调用每个微筛选器驱动程序的 postoperation 回调例程按相反的顺序，从最低到最高 (C、 B、 A)。

互操作性与旧的筛选器驱动程序，筛选器管理器可以将筛选设备对象附加到多个位置中的文件系统 I/O 堆栈。 每个筛选器管理器的筛选设备对象称为*帧*。 从旧的筛选器驱动程序的角度来看，每个筛选器管理器框架是另一种旧的筛选器驱动程序。

每个筛选器管理器框架表示海拔的地区的范围。 筛选器管理器可以调整现有框架，或创建一个新的框架，允许微筛选器驱动程序将附加在正确位置。

筛选器管理器不能将附加了两个附加的旧筛选器之间微筛选器，除非它们之间已筛选器管理器框架。 如果微筛选器用于附加上面旧的筛选器，可以将它附加下方，具体取决于第二个附加旧筛选器存在。 相反，可以上面该旧的筛选器附加了微筛选器，用于将附加在下方的旧的筛选器。

**重要**  始终验证旧筛选器与微筛选器的互操作性或请考虑使用微筛选器替换旧的筛选器。 有关详细信息，请参阅[移植旧筛选器驱动程序的指导原则](guidelines-for-porting-legacy-filter-drivers.md)。

 

如果卸载并重新加载微筛选器驱动程序，它将重新加载在从其已被卸载的同一框架中相同的海拔高度。

下图显示了两个筛选器管理器框架、 微筛选器驱动程序实例与旧的筛选器驱动程序的简化的 I/O 堆栈。

![说明两个筛选器管理器框架、 微筛选器驱动程序实例与旧的筛选器驱动程序的简化的 i/o 堆栈的关系图](images/filter-manager-architecture-2.gif)

 

 




