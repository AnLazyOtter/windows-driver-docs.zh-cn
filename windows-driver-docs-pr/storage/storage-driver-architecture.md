---
title: Windows 存储驱动程序体系结构
description: Windows 存储驱动程序体系结构
ms.assetid: 16636899-fab9-46e8-ab9d-b8d86519b08a
keywords:
- 存储驱动程序 WDK，体系结构
- 存储驱动程序 WDK，类型
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: d767497e10399eb1c7d375d961a92aace4d53056
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56565914"
---
# <a name="windows-storage-driver-architecture"></a>Windows 存储驱动程序体系结构


## <span id="ddk_storage_driver_architecture_kg"></span><span id="DDK_STORAGE_DRIVER_ARCHITECTURE_KG"></span>


Windows 操作系统类和筛选器驱动程序存储外围设备作为任何之间的接口的中间或最高级别上面的类或筛选器驱动程序和系统提供的端口驱动程序的驱动程序。

从用户应用程序或内核组件的 I/O 请求到达存储类驱动程序通过 I/O 系统服务和一个或多个中间或最高级别驱动程序，例如文件系统驱动程序。 存储类驱动程序将转换标准 Irp 它们进入 Irp 用系统定义 SCSI 请求的块 (Srb) 发送到下一步低驱动程序的每个 IRP 之前包含 SCSI 命令描述符块 (Cdb)。 存储端口驱动程序将 Srb 转换到特定于总线的命令将其发送到通过 I/O 总线驱动程序的 HBA，存储类驱动程序和可能是一个或多个筛选器驱动程序。

下图显示了 Windows 存储设备驱动程序的分层体系结构。

![说明基于 nt 的操作系统存储驱动程序的分层体系结构的关系图](images/kg201-1.png)

Windows 存储驱动程序体系结构

从图底部开始，下面介绍的每种类型的存储驱动程序：

1.  一个*存储端口驱动程序*定义到所有 Windows 存储类驱动程序，包括系统提供磁盘、 磁带、 CDROM、 DVD 和换带机类的驱动程序的接口。 使此端口/类接口的类驱动程序从其各自的设备连接到的主机总线适配器的特定于适配器的要求。 存储端口驱动程序还将同步到总线上相应的 HBA 的设备的所有驱动程序的访问权限。 系统提供 SCSI、 IDE、 USB 和 IEEE 1394 适配器存储端口驱动的程序。

    存储端口驱动程序的下一个更高版本驱动程序 （存储类驱动程序或干扰的筛选器驱动程序） 从接收 Srb，并对其进行处理，如下所示：

    -   SCSI、 或其他总线存储端口驱动程序将使用 Cdb Srb 传递到独立于操作系统，HBA 特定*Storport 微型端口驱动程序*，哪些动态链接到其相应的端口驱动程序，并提供了特定 HBA 的特定于硬件的支持。 有关实现 SCSI 微型端口驱动程序的信息，请参阅[Storport 微型端口驱动程序](storport-miniport-drivers.md)。
    -   旧的 IDE/ATAPI 或 IEEE 1394 总线的存储端口驱动程序将转换的存储类驱动程序从接收到的基础适配器-例如，所需的格式根据总线特定于传输协议，重新打包 Cdb Srb 或将它们翻译成其他格式，从而使基础总线失望的上部级别驱动程序。

2.  Upper 或 lower*存储筛选器驱动程序*支持系统提供的存储类驱动程序不提供特定于设备的功能。 较低的筛选器存储驱动程序监视 Srb 和/或存储类驱动程序发出的 Irp，并根据需要将其传递给下一个较低驱动程序 （存储端口驱动程序或另一个存储筛选器驱动程序） 之前修改它们。

    有关实现存储筛选器驱动程序的信息，请参阅[存储筛选器驱动程序](storage-filter-drivers.md)。

3.  一个*存储类驱动程序*使用 SCSI 端口/类接口来控制其类型系统为其提供存储端口驱动程序任何总线上的设备。 类驱动程序专为特定类的设备--例如，一个类驱动程序可以 CD-ROM 的所有设备上都运行任何受支持的总线;另一个可以控制磁盘的所有设备。 存储类驱动程序通过构建 Srb 包含 Cdb 和颁发这些 Srb 下一步低驱动程序 （存储端口驱动程序或干扰的筛选器驱动程序），就像处理来自用户应用程序或驱动程序存储堆栈中的 I/O 请求如果设备已 SCSI 设备。

    存储类驱动程序的实现是透明的上部级别驱动程序。 作为链接到系统提供的类驱动程序的特定于设备的 miniclass 驱动程序实现的磁带或媒体更换器设备的类驱动程序。 对于其他存储设备，例如磁盘和 CD 的 ROM/DVD，系统提供的类驱动程序将作为单个整体式驱动程序。

    有关实现存储类驱动程序的信息，请参阅[存储类驱动程序](storage-class-drivers.md)。 有关实现磁带或换带机 miniclass 驱动程序的信息，请参阅[磁带驱动程序](tape-drivers.md)并[更换器驱动程序](changer-drivers.md)分别。

4.  上部的筛选器存储驱动程序从用户应用程序和驱动程序存储堆栈中截获 Irp，并可能修改，然后将其传递给下一个较低驱动程序 （存储类驱动程序或另一个存储筛选器驱动程序）。 筛选器驱动程序通常监视基础设备的性能。

总线向其附加设备和其存储端口驱动程序的实现是透明的上部级别驱动程序的类型。 可能会根据端口/微型端口驱动程序体系结构，如 SCSI 端口驱动程序; 实现存储端口驱动程序作为整体的驱动程序，用于控制标准的硬件，如 IDE/ATAPI 端口驱动程序;或作为筛选器驱动程序的 Srb 将转换为不同的驱动程序堆栈，如 IEEE 1394 端口驱动程序所需的格式。

系统提供 SCSI 端口驱动程序也可用作存储类驱动程序和 SCSI 的微型端口驱动程序，用于控制相同类型的非 SCSI 存储设备之间的接口。 例如，而不是为新的磁盘阵列控制器编写一个驱动程序，驱动程序编写器可以保存大量设计、 开发和调试工作，通过编写伪 SCSI 微型端口驱动程序链接到系统 SCSI 端口驱动程序，并使用该接口它提供了。 这样的微型端口驱动程序需要将传入的 SCSI 命令转换为特定于设备的命令。 但是，系统提供端口和类驱动程序处理的代表伪 SCSI 微型端口 presizing 的请求在初始化、 所有资源和对象的分配、 同步期间包括注册表访问非常必要的工作将传输以满足功能的微型端口的设备和重试请求。

有关 Srb 的更多详细信息，请参阅内核模式驱动程序体系结构参考。 有关 Cdb 特定于设备的类型的信息，请查阅 INCITS scsi-3 标准中的相应命令集。

 

 




