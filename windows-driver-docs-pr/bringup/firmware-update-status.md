---
title: 固件更新状态
description: 此时应将应用所有固件更新，并在 ESRT 反映在 Windows OS 加载程序的后续调用上的所有更新的结果。
ms.assetid: 988B1E95-2268-4B4F-B0C6-3C965FCD1B1C
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 4e397833e94ce9cc45c5a1d9dbefeace8945de10
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56541634"
---
# <a name="firmware-update-status"></a>固件更新状态


此时应将应用所有固件更新，并在 ESRT 反映在 Windows OS 加载程序的后续调用上的所有更新的结果。 返回引用中的 ESRT 示例[ESRT 表定义](esrt-table-definition.md)以及中的固件资源更新驱动程序 INF 包示例[创作更新驱动程序包](authoring-an-update-driver-package.md)，如果版本 2 的 firmware.bin 的时间已成功应用固件，然后新 ESRT 表会反映这一点。 请注意，表中的唯一区别是系统固件资源条目的固件版本和上次尝试版本字段已更改以反映已成功应用新的固件版本。

| 字段                               | 值                     | 备注                                                                                                                                                                                                              |
|-------------------------------------|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 固件资源计数             | 2                         | 此表包含两个固件资源条目。                                                                                                                                                                   |
| 固件资源最大值           | 2                         | 此表分配包含足够的空间来描述最多为两个资源。                                                                                                                                  |
| 资源的固件版本           | 1                         | 此表使用的固件资源条目格式版本为 1。                                                                                                                                                     |
| 固件资源条目数组       | 固件资源条目 0 |                                                                                                                                                                                                                      |
|   固件类                    | (系统\_固件)        | 此 GUID 标识通过即插即用更新的系统固件。                                                                                                                                                         |
|   固件类型                     | 1                         | 系统固件类型为 1。                                                                                                                                                                                           |
|   固件版本                  | 2                         | 当前的系统固件版本为 2。                                                                                                                                                                            |
|   最低受支持的固件版本 | 2                         | 更改为 2，最低的受支持的固件版本，以便在固件不能回滚到版本早于版本 2。 固件更新包含的安全修补程序时，通常被更改此值。 |
|   封装标志                     | 0                         | 系统固件没有定义任何专用的封装更新标志。                                                                                                                                                     |
|   上次尝试版本              | 2                         | 为其尝试更新最后一个系统固件版本为 2                                                                                                                                             |
|   上次尝试的状态               | 0                         | 最后一个系统固件更新尝试成功。                                                                                                                                                              |
|                                     | 固件资源条目 1 |                                                                                                                                                                                                                      |
|   固件类                    | (设备\_固件)        | 此 GUID 标识通过即插即用更新设备固件。                                                                                                                                                         |
|   固件类型                     | 2                         | 设备固件类型为 2。                                                                                                                                                                                           |
|   固件版本                  | 1                         | 当前设备固件版本为 1。                                                                                                                                                                            |
|   最低受支持的固件版本 | 1                         | 将最低受支持的固件版本保留为 1。 固件可以回滚到版本 1，如有必要。                                                                                                          |
|   封装标志                     | 0x8010                    | 设备固件定义专用封装更新标志 (0x8010)。                                                                                                                                                       |
|   上次尝试版本              | 1                         | 为其尝试更新最后一个设备固件版本为 1。                                                                                                                                             |
|   上次尝试的状态               | 0                         | 最后一次设备固件更新尝试成功。                                                                                                                                                              |

 

如果固件不能成功应用更新，然后固件版本、 上次尝试的版本和上次尝试的状态条目 ESRT 中将反映失败的更新尝试。 例如，如果系统正在尝试更新到版本 2 的版本 1 的固件，并将故障到已成功应用更新，则固件版本 = 1，最后尝试版本 = 2 和上一次尝试状态 ！ = 0。 （即上次尝试的状态设置为相应的非零错误代码指示原因失败。 为此条目的有效的错误代码的列表，请参阅[ESRT 表定义](esrt-table-definition.md)。

尽管标准更新策略强制实施固件版本可以仅增加，可以出于测试目的，如下面的"请回滚固件更新"部分中所述的策略设置通过禁用此策略。

## <a name="system-reset"></a>系统重置


系统重置允许最终用户恢复他们的系统还原为出厂设置。 它通过来实现此重新在制造过程中安装预加载到系统的 Windows 映像。 整个操作系统，包括驱动程序和应用程序，将重新安装。

**请注意**  由于固件回滚阻止跨安全边界的安全要求，系统重置不能回滚固件版本以匹配原始部署在工厂中的固件。 这意味着，所有版本的固件都必须与在该平台上提供的所有驱动程序和操作系统版本向后兼容。 如果固件不兼容，这可能导致用户返回他们的系统制造商。

 

## <a name="rolling-back-firmware-updates"></a>回滚固件更新


在某些情况下它可能有必要固件更新例如更新测试期间回滚。 每个 ESRT 报告固件资源在以下注册表项中具有一个条目：HKLM\\系统\\CurrentControlSet\\控制\\FirmwareResources。

此条目是具有名称与用于报告 ESRT 中的资源 GUID 相等的键。 若要允许固件回滚，创建 REG\_DWORD 值调用策略，并将值设置为 1。 给定的固件资源可以仅将其回滚到其各自最低支持固件版本、 ESRT 中指定。 这是为了防止超出的关键安全修补程序已对固件的位置的固件回滚。 如果您正在回滚到的固件版本满足这些条件，则操作系统加载程序将更新到较旧版本。

## <a name="related-topics"></a>相关主题
[ESRT 表定义](esrt-table-definition.md)  
[Plug and play 设备](plug-and-play-device.md)  
[创作更新驱动程序包](authoring-an-update-driver-package.md)  
[处理更新](processing-updates.md)  
[设备 I/O 从 UEFI 环境](device-i-o-from-the-uefi-environment.md)  
[无缝危机预防和恢复](seamless-crisis-prevention-and-recovery.md)  



