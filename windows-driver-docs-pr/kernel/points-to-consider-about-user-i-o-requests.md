---
title: 有关用户 I/O 请求的要点
description: 有关用户 I/O 请求的要点
ms.assetid: e8143055-4ad7-4e39-a2f2-64d9e79d33a0
keywords:
- 特定于设备的 I/O 控制代码 WDK 内核
- 专用的 I/O 控制代码 WDK 内核
- 分层驱动程序 IRP 处理 WDK 内核
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: ad8eb642292743150b6533b6e49b7bef91435a0e
ms.sourcegitcommit: fb7d95c7a5d47860918cd3602efdd33b69dcf2da
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 06/25/2019
ms.locfileid: "67362919"
---
# <a name="points-to-consider-about-user-io-requests"></a>有关用户 I/O 请求的要点





设计的内核模式驱动程序时，请记住以下几点：

- 驱动程序可以进行分层，并且多个驱动程序可以处理单个 I/O 请求 (IRP)。

- 驱动程序不能进行哪些其他驱动程序将设备堆栈中的任何假设。 因此，每个驱动程序应准备好接收来自任何其他驱动程序请求，并且应该能够应对所有潜在的错误情况。

- 驱动程序进行通信的 IRP I/O 状态块中请求的 I/O 操作成功与否。 给用户模式下请求者请求的 I/O 操作成功与否，I/O 管理器进行通信。

- 驱动程序不需要并且不应旨在提供特定于应用程序的支持。 受保护的子系统或其子系统特定，用户模式驱动程序将提供这种支持。 此规则的例外： 依赖于应用程序专用的设备的 MS-DOS 应用程序可以要求内核模式驱动程序来控制设备和一个紧密耦合的 Win32 用户模式虚拟设备驱动程序 (VDD)。 有关 VDDs 的详细信息，请参阅 Windows 驱动程序开发工具包 (DDK) 中的虚拟设备驱动程序文档。 (在 DDK 前面带有 Windows Driver Kit \[WDK\]。)

- 新的驱动程序必须处理同一套**IRP\_MJ\_* XXX*** 作为它将替换任何系统提供的驱动程序。 I/O 管理器将返回状态\_无效\_设备\_请求对目标设备的给定 I/O 请求，如果其驱动程序没有为此，定义入口点<strong>IRP\_MJ\_* XXX</strong><em>.设备驱动程序还必须处理的相同的 I/O 控制代码[ </em> *IRP\_MJ\_设备\_控制** ](<https://msdn.microsoft.com/library/windows/hardware/ff550744>)与任何请求它将替换系统提供驱动程序。 换而言之，新的设备驱动程序必须不会"中断应用程序"通过实现更少的功能比现有驱动程序为同一类型的设备。

- 新的中间驱动程序插入到链中的现有驱动程序应识别属于同一套**IRP\_MJ\_* XXX*** 作为驱动程序，它将取代。 新的驱动程序可以只需传递 Irp 上不会处理到下一步低级驱动程序这些请求。 但是，新的中间驱动程序必须不"分页符链"更高版本的驱动程序，它通过忽略了定义一个条目下面点**IRP\_MJ\_* XXX*** 请求的新移位后下, 一步-较低级别驱动程序无法处理。

- 最低级别驱动程序可以访问仅其自己 I/O 堆栈的位置中将其发送任何 IRP。 更高级别的驱动程序只能访问其自己和发送任何 IRP 中的下一步低级驱动程序的 I/O 堆栈位置。

- 每个驱动程序会因为 I/O 管理器零作为链中每个驱动程序的相应 I/O 堆栈位置仅在 Irp 的 I/O 状态块中将信息到更高级别的驱动程序 （和从根本上讲，为用户模式应用程序中通过 I/O 管理器）完成 IRP。 任何新的驱动程序时，尝试实现更高版本 （或更低） 的特定驱动程序的折中方案后门通信，其可移植性，并与从一个 Windows 平台或版本到下一个其他驱动程序及其互操作性。

- 驱动程序的一对可以定义特定于设备的一组 (也称为*私有*) 的 I/O 控制代码[ **IRP\_MJ\_内部\_设备\_控件**](https://docs.microsoft.com/windows-hardware/drivers/kernel/irp-mj-internal-device-control)该对的更高版本可以发送到该对的较低的请求。 但是，此类对驱动程序必须遵循所有前面的准则若要保持可移植，并可与其他驱动程序从一个 Windows 平台或版本到另一个互操作。 如果将设计一个对具有专用接口的驱动程序，请考虑 I/O 控制代码，以慎重定义的集。 使它们尽可能为通常很有用并设计配对驱动程序遵循上述指导原则，以便你 （或其他人） 可以重复使用、 替换或轻松取代一个或两个新的驱动程序，因为它们从一个 Windows 平台或版本迁移另一个。

 

 




