---
title: 包含多个处理器安全
description: 包含多个处理器安全
ms.assetid: 58c51f3e-98c4-4aa0-ad4d-cd9225f78141
keywords:
- 多处理器安全 WDK 内核
- 对称多处理器平台 WDK 内核
- SMP WDK 内核
- 数值调节钮锁 WDK 内核
- 同步 WDK 内核，多处理器的安全
- 对称平台 WDK 内核
- 锁定 WDK 内核
- 死锁 WDK 内核
- 关键节例程 WDK 内核
- 共享的数据保护 WDK 内核
- 调度程序对象 WDK 内核，多处理器的安全
- 内核调度程序对象 WDK、 多处理器的安全
ms.date: 06/16/2017
ms.localizationpriority: medium
ms.openlocfilehash: 8985ac00d69fcadda8a7b2fb05e57068d9061494
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56523574"
---
# <a name="multiprocessor-safe"></a>包含多个处理器安全





基于 Microsoft Windows NT 的操作系统专为在单处理器和对称多处理器 (SMP) 平台上运行统一和内核模式驱动程序应设计为可执行同样操作。

在任何 Windows 多处理器平台中，存在以下情况：

-   所有的 Cpu 都完全相同，并且全部或无处理器必须具有相同的协处理器。

-   所有 Cpu 共享内存，并有统一访问的内存。

-   在中*对称*平台，每个 CPU 都可以访问的内存、 采用中断，和访问 I/O 控制寄存器。 (相比之下，在*非对称*一个 CPU 采用所有从属 Cpu 的一组中断的多处理器计算机。)

若要安全地运行的 SMP 平台上，操作系统必须保证在一个处理器执行的代码不会不同时访问和修改数据的访问和修改另一个处理器。 例如，如果最低级别驱动程序的 ISR 正在处理一个处理器上的设备中断，它必须具有独占访问设备寄存器或驱动程序定义的关键数据，以防其设备同时中断另一个处理器上。

此外，驱动程序的 I/O 操作在单处理器计算机中已进行序列化可以重叠 SMP 计算机中。 即，处理传入的 I/O 请求的驱动程序的例程可以一个处理器上执行时与设备通信的另一个例程在另一个处理器上同时执行。 是否在单处理器或对称多处理器计算机上执行内核模式驱动程序，它们必须同步对任何驱动程序定义的数据或系统提供驱动程序例程之间共享和同步到物理访问的资源的访问设备 （如果有的话）。

Windows NT 内核组件会导出同步机制，称为[旋转锁](spin-locks.md)、 驱动程序可以使用来保护共享数据 （或设备注册） 同时访问由正在运行的一个或多个例程同时在对称多处理器平台。 内核强制实施有关的自旋锁使用的两个策略：

-   在任意给定时刻，只有一个例程可容纳特定自旋锁。 访问共享的数据之前, 的数据，必须引用每个例程必须首先尝试获取数据的自旋锁。 若要访问相同的数据，另一个例程必须获得旋转锁，但不能获取数值调节钮锁，直到当前持有者将其释放。

-   内核将 IRQL 值分配给每个旋转锁，在系统中。 仅当在旋转锁分配 IRQL 运行，该例程时，内核模式例程可以获取一个特定数值调节钮锁。

这些策略可防止一个驱动程序例程通常在较低的 IRQL 运行，但当前包含尝试获取同一个数值调节钮锁的优先级较高的驱动程序例程被抢占的自旋锁。 因此，避免死锁。

分配给旋转锁 IRQL 通常是，能够获取数值调节钮锁的最高 IRQL 例程。

例如，最低级别驱动程序的 ISR 经常与驱动程序的 DPC 例程共享状态区域。 DPC 例程调用驱动程序提供*临界区*例程，以访问共享的区域。 保护共享的区域的自旋锁具有等于设备会中断的 DIRQL IRQL。 只要临界区例程持有自旋锁和访问在 DIRQL 共享的区域，则无法在单处理器或 SMP 计算机运行 ISR。

-   ISR 无法运行，在单处理器计算机中因为屏蔽设备中断，如中所述[始终 Preemptible 且始终不中断](always-preemptible-and-always-interruptible.md)。

-   在 SMP 计算机中，ISR 无法获取关键节例程持有自旋锁和访问 DIRQL 上的共享的数据时保护共享的数据的数值调节钮锁。

一组内核模式线程可以通过一个内核的调度程序对象正在等待同步访问共享的数据或资源： 事件、 mutex、 信号量、 计时器或另一个线程。 但是，大多数驱动程序未设置其自己的线程因为它们避免线程上下文切换时它们具有更好的性能。 时间关键的内核模式下支持例程和驱动程序只要运行在 IRQL = 调度\_级别或 DIRQL，它们必须使用内核的自旋锁来同步对共享的数据或资源的访问。

有关详细信息，请参阅[旋转锁](spin-locks.md)，[管理硬件优先级](managing-hardware-priorities.md)，并[内核调度程序对象](kernel-dispatcher-objects.md)。

 

 




