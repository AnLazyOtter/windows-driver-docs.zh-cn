---
title: 轮询回调
description: 轮询回调
ms.assetid: d86ed391-19c6-47e4-83df-cc2f2298846a
keywords:
- 轮询 WDK 游戏杆
- 回调 WDK 游戏杆
- 游戏杆 WDK HID 轮询
- 虚拟游戏杆驱动程序 WDK HID、 轮询
- VJoyD WDK HID，轮询
- 游戏杆 WDK HID，位置
- WDK 游戏杆的位置
- WDK 游戏杆的位置
ms.localizationpriority: medium
ms.date: 10/17/2018
ms.openlocfilehash: eac6e5d7bfbb830358c84d970e7f684280db3bd9
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56522938"
---
# <a name="polling-callback"></a>轮询回调





```cpp
int stdcall PollRoutine( int type, LPJOYOEMPOLLDATA pojd );
```

轮询例程称为调用 joyGetPos 的应用程序中直接响应，或者 joyGetPosEx，或当 Windows 95/98/我定期调用 joyGetPos 应用程序的调用 joySetCapture。 仅当微型驱动程序首次接收其轮询回调的调用，它可以是特定应用程序需要从其数据。 所有其他回调调用目前在 16 可用游戏杆，列表中的所有设备的任何应用程序是否已请求数据。

可能的返回值为乐趣\_OEMPOLLRC\_YOUPOLL，乐趣\_OEMPOLLRC\_会失败，因此乐趣\_OEMPOLLRC\_确定。 仅限按钮的投票中，除了返回的值解释为任一 JOYERR\_NOERROR 或 JOYERR\_拔出之前返回到应用程序。 始终假定按钮轮询才能成功。

JOY\_OEMPOLLRC\_如果轮询一次的设备没有响应，或如果 VJoyD 请求微型驱动程序无法处理某次轮询，则返回 FAIL。 在前一种情况，应确保不以失败设备，除非它确实已失败，因为应用程序可能会阻止所有内容并请求用户检查到设备的连接。 例如，如果第一次轮询失败失败 joySetCapture 调用。 从设备故障不会导致故障报告直到则需要用户干预或检测到无法恢复设备错误。 例如，使用基于数据包的协议进行通信的设备应尝试重试，如果一个数据包不是有效故障轮询前。

务必要识别正版设备故障并最终; 返回一个错误否则，应用程序不能确定是否在所有用户干预为必需。 如果旧的或 false 的数据返回时执行的错误恢复、 返回的数据的含义，允许，轮询的行数或允许从初始错误的时间应限制因此驱动程序不会不延迟很长的时间。 当请求微型驱动程序时不会控制，在设备上执行轮询或执行轮询类型或它无法提供服务的子类型时，失败始终是正确的响应。

可以使用乐趣\_OEMPOLLRC\_YOUPOLL 如果标准模拟轮询会生成正确结果。

应返回乐趣\_OEMPOLLRC\_正则用例时使用请求的数据填充 JOYINFOEX 结构中的确定。

如果使用轮询来在设备上执行初始化，您必须采取措施。 应用程序可以执行初始轮询，以通过检查返回代码来检查设备的可用性。 然后，这些用户可与任何错误检查的后续轮询。 这是实质上是哪些 joySetCapture。 理想情况下，应执行所有初始化和第一次轮询。 这种情况下，需在其中设置到第二个设备持续的时间，便已足够，若要验证设备存在并正在工作，并返回第一次轮询的静态数据。

API 和系统驱动程序对应用程序发出的请求执行验证，并将所需的数据复制到完成后的应用程序结构。 微型驱动程序不应复制此功能。 但是，执行任何操作会从另一个时仍处于轮询轮询设备阻止一个进程。 此事件的影响的是不会高于报告两个轴的不同示例。 如有必要，微型驱动程序可以执行其自身进程的同步。

返回值取决于"type"参数和设备它支持。 应始终返回按钮和按钮编号。 因为没有到微型驱动程序指定 POV 轮询是必需的方法，如果任何轴请求应返回此值。 设置 POV\_如果设备不支持未定义。 中的单个轴投票中，返回的值**dwX** JOYPOLLDATA 结构中的成员 ( [ **VJPOLLDATA** ](https://msdn.microsoft.com/library/windows/hardware/ff543573)结构 DirectX 5.0 及更高版本)。 用于多个轴请求中的所请求的轴数为奇数，**做\_其他**的成员[ **JOYOEMPOLLDATA** ](https://msdn.microsoft.com/library/windows/hardware/ff542251)结构指定是否在位置或者以下轴，则返回最后一个轴。 在三个轴投票中，例如，该成员指定所返回的轴是否 X、 Y、 Z 或 X、 Y、。

以下是其他可能的返回值，按类型分类的列表 (可以填写额外的数据，但请注意必须解码的轴数为奇数的所有轮询**做\_其他**成员以确定它所返回):

-   JOY\_OEMPOLL\_GETBUTTONS:没有额外内容。

-   JOY\_OEMPOLL\_POLL1:中指定的轴**做\_其他**中返回成员**dwX**成员。

-   JOY\_OEMPOLL\_POLL2:返回 X 和 Y 轴**dwX**并**dwY**成员。

-   JOY\_OEMPOLL\_POLL3:返回 X 和 Y 轴**dwX**并**dwY**成员。

    如果**做\_其他**成员为非零值中, 返回 R 轴**dwR**成员。 否则，在返回 Z 轴**dwZ**成员。

-   JOY\_OEMPOLL\_POLL4:返回 X、 Y、 Z 和 R 轴**dwX**， **dwY**， **dwZ**，以及**dwR**成员分别。

-   JOY\_OEMPOLL\_POLL5:返回 X、 Y、 Z 和 R 轴**dwX**， **dwY**， **dwZ**，以及**dwR**成员分别。

    如果**做\_其他**成员为非零值，在返回 V 轴**dwR**成员。 否则，在返回 U 轴**dwZ**成员。

-   JOY\_OEMPOLL\_POLL6:中返回 X、 Y、 Z、 R、 你和 V 轴**dwX**， **dwY**， **dwZ**， **dwR**， **dwU**，和**dwV**成员分别。

DirectX 3.0 添加非轮询种乐趣\_OEMPASSDRIVERDATA，在其中**不要\_其他**成员包含应用程序将传递一个 dword 值。 可用于任何微型驱动程序定义的函数，此 DWORD，但它旨在特别是启用完全识别微型驱动程序将发送特定于设备的命令和配置信息的自定义安装应用程序。

微型驱动程序应返回乐趣\_OEMPOLLRC\_失败，它不支持的所有类型。

尽管双字中返回的轴数据，但轴值的范围应限制为大约 10 位值如果标准游戏杆控件面板配置用作唯一的配置机制。 由于用户无法轻松地看到发生了什么情况，这有助于避免混淆。 若要帮助完成与现有的应用程序兼容性，微型驱动程序返回的轴应不同于返回的模拟游戏杆 （如果适用）。 例如，X 将在左侧，依此类推最小化的从左到右移动。

为已激活的 POV 帽，方向应表示为角度，以度为单位，乘以 100，使用 0 表示向前移动，9000，18000 向后和 27000 左。

由于轮询例程调用是只输入正表明设备仍在使用中，使用共享的资源，如通信端口应跟踪的上一次使用它们的微型驱动程序。 如果使用时间变得很重要，应停止微型驱动程序以采样设备，然后在用户已完成设备使用情况，现在正尝试使用该资源用于其他用途的情况下释放资源。 这是特别重要，如果有通信错误的匹配项，因为这可能表示该设备拔出。

 

 




