---
title: 网络适配器中的性能
description: 在决定哪些硬件上的网络适配器实现的函数始终有权衡取舍。
ms.assetid: 7BE3FC13-DEE1-41A2-9B4A-D04CF5D0FC9B
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 9727e824c63acc9b0ecde67e2e739d1ef15100b7
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56562556"
---
# <a name="performance-in-network-adapters"></a>网络适配器中的性能


在决定哪些硬件上的网络适配器实现的函数始终有权衡取舍。 它变得越来越重要，若要添加的中断裁决，动态优化的硬件上允许的任务卸载功能，请考虑提高 PCI 总线中，使用和支持 Jumbo 帧。 这些是将在需要最重要的性能的配置中使用的高端的网络适配器尤为重要。

-   [支持 TCP 和 IP 校验和卸载](#supporting-tcp-and-ip-checksum-offload)
-   [支持大量发送卸载 (LSO)](#supporting-large-send-offload-lso)
-   [支持 IP 安全 (IPSec) 卸载](#supporting-ip-security-ipsec-offload)
-   [提高中断裁决](#improving-interrupt-moderation)
-   [有效地使用 PCI 总线](#using-the-pci-bus-efficiently)
-   [支持 jumbo 帧](#supporting-jumbo-frames)

## <a name="supporting-tcp-and-ip-checksum-offload"></a>支持 TCP 和 IP 校验和卸载


最常见的网络流量，卸载网络适配器硬件的校验和计算的每个字节所需的 CPU 周期数，从而提供显著的性能优势。 校验和计算以下两个原因是网络堆栈中的开销最大函数：

-   它有助于长路径长度。
-   它会导致缓存改动 （通常对发件人） 的影响。

通过减少主机 CPU 上的负载和增加缓存有效性卸载到发件人的校验和计算提高了整体系统性能。

在 Windows 性能实验室中，我们测 19%的 TCP 吞吐量改进时在网络密集型工作负荷期间已卸载的校验和。 这一改进的分析显示由于路径长度缩短，原本是总改进的 11%8%是由于增加缓存有效性。

卸载接收方上的校验和已卸载上发件人的校验和与相同的好处。 可以充当客户端和服务器，例如，套接字代理服务器的系统上看到更高的权益。 在系统上 CPU 不一定是繁忙，如客户端系统，更好的网络响应时间，而不是以明显更大的吞吐量，可能出现的卸载校验和权益。

## <a name="supporting-large-send-offload-lso"></a>支持大量发送卸载 (LSO)


Windows 提供的网络适配器/驱动程序将最多为 64 K 播发更大最大段大小 (MSS) 比为 TCP MTU 的功能。 这样 TCP 就能分配给驱动程序，将较大缓冲划分为适合网络 MTU 的数据包最多 64 K 的缓冲区。

对工作进行分段的 TCP 通过而不是主机 CPU 的网络适配器/驱动程序硬件。 这将导致显著的性能改进，如果 CPU 的网络适配器能够处理额外的工作。

对于许多测试的网络适配器，时改善主机 CPU 的时间比网络适配器硬件功能更强大的纯网络活动所示。 但是，对于典型的业务工作负荷，总体系统性能提高了吞吐量的最多缩短 9%被测量了，因为主机 CPU 使用大部分其周期来执行事务。 在这些情况下，卸载到硬件 TCP 分段释放主机 CPU 负载中的分段，从而允许额外循环执行更多的事务。

## <a name="supporting-ip-security-ipsec-offload"></a>支持 IP 安全 (IPSec) 卸载


Windows 提供任务卸载到网络适配器硬件的 IPSec 加密的功能。 加密，尤其是 3 DES (也称为三重 DES)，具有非常高的周期字节比率。 因此，它是不令人惊讶，IPSec 卸载网络适配器硬件度量在安全的 Internet 和 VPN 测试中的 30%的性能提升。

## <a name="improving-interrupt-moderation"></a>提高中断裁决


简单的网络适配器的数据包的完成信号发送请求或生成数据包到达主机上的硬件中断。 中断滞后时间和结果缓存改动效果增加开销的整体网络性能。 在许多情况下 （例如，高系统使用情况或大量网络流量），最好处理有多个数据包的每个中断减少硬件中断的成本。

大量网络工作负荷，具有已达 9%的性能改进吞吐量测得网络密集型工作负荷。 但是，优化吞吐量改进中断裁决参数可能会导致性能下降的响应时间。 若要维护最佳设置并适应不同的工作负荷，最好允许动态调整后的参数的自动调节更高版本中这篇文章中所述。

## <a name="using-the-pci-bus-efficiently"></a>有效地使用 PCI 总线


网络适配器硬件性能的最重要因素之一是它如何有效地使用 PCI 总线。 此外，网络适配器的 DMA 性能影响性能的相同 PCI 总线上的所有 PCI 卡。 优化 PCI 使用情况时，必须考虑以下准则：

-   通过在适当的聚合目标页来简化 DMA 传输。

-   在大型的区块 （至少 256 个字节） 中执行 DMA 开销减少 PCI 协议。 如果可能，使整个数据包传输单个 PCI 事务中的时间的数据流。 但是，请考虑传输应如何发生。 例如，不等待的所有数据到达，然后才能启动传输，因为正在等待将增加延迟时间并消耗更多的缓冲区空间。

-   它是更好的做法填充 DMA 数据包传输与其他字节数，而不是要求简短的额外传输以传输数据包的最后几个字节"清理"。

-   按照 PCI 规范的建议，请使用内存读取、 内存读取行和内存读取多个事务。

-   网络适配器总线接口硬件应检测限制中的主机内存控制器，并相应地调整行为。 在示例中，网络适配器总线接口硬件应 DMA 内存读取上检测内存控制器预提取限制并等待片刻然后再尝试该事务。 硬件应检测网络适配器的部分过多的重试次数和增加的时间之前第一个将来的交易时截断由主机上重试。 没有在继续提交到内存控制器的事务时不能确定它仍忙于提取下一组有序的数据点。

-   最小化等待状态，尤其是在数据传输过程中的插入的操作。 更好释放总线，并允许使用总线 get 如果多个完成一些工作的另一个 PCI 适配器，或者将插入以下两种等待状态。

-   使用内存映射 I/O 而不是编程 I/O。 这也是驱动程序，则返回 true。

## <a name="supporting-jumbo-frames"></a>支持 jumbo 帧


支持更大的最大传输单位 (Mtu)，因此更大的帧大小，特别是 Jumbo 帧，会减少每个字节所产生的网络堆栈开销。 MTU 1514 从更改为 9000 时已测量了 TCP 吞吐量增加 20%。 此外，由于只有少数几个从网络堆栈到网络驱动程序的调用获取 CPU 使用率的显著降低。

 

 





