---
title: NDIS 虚拟机队列状态
description: NDIS 虚拟机队列状态
ms.assetid: 69a301ac-71f4-4591-80ff-356c32187aa8
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: ad6d98f0fbe865471f6e792db96dd29362c023cf
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "63369034"
---
# <a name="ndis-virtual-machine-queue-states"></a>NDIS 虚拟机队列状态





本主题概述 NDIS 虚拟机队列 (Vmq) 的操作状态。 队列状态的详细信息，请参阅[队列状态和操作](queue-states-and-operations.md)中的主题[编写 VMQ 驱动程序](writing-vmq-drivers.md)部分。

对于每个队列，网络适配器必须支持以下一组操作状态：

-   未定义

-   分配

-   设置

-   已暂停

-   正在运行

-   停止 DMA

-   释放

下图显示了这些状态之间的关系。

![演示如何 ndis vm 队列状态和事件的关系图](images/queuestate.png)

以下定义的适配器状态：

<a href="" id="undefined"></a>未定义  
*未定义*是队列的初始状态。 在此状态下，队列不分配。 微型端口驱动程序收到队列分配请求之前，未定义队列 （除默认队列始终存在）。 此外，它是未定义后可用的操作已完成，并且任何接收指示已启动都已完成。

<a href="" id="allocated"></a>分配  
队列处于*已分配*状态分配请求之后且之前有队列上设置任何筛选器。 如果队列是在设置状态，并且最后一个筛选器清除队列，该筛选器还可以输入的已分配状态。 如果微型端口驱动程序收到分配完整请求微型端口驱动程序处于已分配状态时，队列将进入暂停状态。 如果微型端口驱动程序收到的免费队列请求，队列将进入停止 DMA 状态。

<a href="" id="set"></a>设置  
在中*设置*状态时，分配的队列和队列上设置至少一个筛选器但微型端口驱动程序未收到分配尚未完成 OID。 如果收到分配完成请求，队列将进入运行状态。 如果清除该队列上的最后一个筛选器，队列将进入已分配状态。 请注意在队列上的筛选器集时，不能释放队列。

<a href="" id="paused"></a>已暂停  
在中*已暂停*状态时，队列分配，但其微型端口驱动程序不指示接收到的数据包，因为没有队列上设置筛选器。 微型端口驱动程序可以输入暂停状态，从已分配状态或从运行状态。 接收筛选器集请求时，队列将进入运行状态。 接收免费的排队请求时，队列将进入停止 DMA 状态。

<a href="" id="running"></a>运行  
在中*运行*状态下，队列的筛选器设置、 队列分配已完成，并且网络适配器指示接收数据包。 如果清除该队列上的最后一个筛选器，队列将进入暂停状态。 请注意在队列上的筛选器集时，不能释放队列。 此外，微型端口驱动程序可以停止 DMA 清除最后一个筛选器。 但是，微型端口驱动程序不应在这种情况下发送 DMA 停止状态指示。

<a href="" id="stop-dma"></a>停止 DMA  
在中*停止 DMA*状态下，微型端口驱动程序收到了一个免费的队列请求，必须停止 DMA 活动。 微型端口驱动程序必须发送的 DMA 停止状态指示。 微型端口驱动程序发送的状态指示后，队列将处于释放状态。 请注意最后一个筛选器已被清除时，可能已停止 DMA。 但是，微型端口驱动程序应该只发送状态指示，当它收到免费队列请求。

<a href="" id="freeing"></a>释放  
在中*释放*状态下，正在等待未完成所有接收到队列，若要完成的指示，释放与队列相关联的资源的微型端口驱动程序。 所有资源也将释放后，队列将进入未定义的状态。

 

 





