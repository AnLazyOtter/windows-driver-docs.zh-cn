---
title: 使用 Avcstrm.sys
description: 使用 Avcstrm.sys
ms.assetid: 53430526-ee24-4081-b220-4089d60aec94
keywords:
- 筛选器驱动程序 WDK AV/C 的流式处理
- AV/C WDK，Stream 筛选器驱动程序
- Stream 筛选器驱动程序 WDK AV/C
- 流式处理有关 Avcstrm.sys 流式处理筛选器驱动程序筛选器驱动程序 WDK，Avcstrm.sys
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: d74ef3d5f708d514fa2e8c8e575c9c15fc91f52a
ms.sourcegitcommit: 0cc5051945559a242d941a6f2799d161d8eba2a7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "63323259"
---
# <a name="using-avcstrmsys"></a>使用 Avcstrm.sys





AV/C 流式处理筛选器驱动程序*Avcstrm.sys*，其客户端子单元驱动程序创建数据流后提供服务。 可分类的数据流执行三个函数： 数据进行流式处理、 时钟提供商和获取和设置的流属性或事件。 这三个函数是彼此相关，和控件的流状态 （stop、 暂停或运行） 的数据流的行为。

子单元驱动程序第一次请求*Avcstrm.sys*与给定的数据格式创建的流。 这种数据格式包含的使用中 IEC 61883-的信号格式定义*x*协议规范。 数据格式可以是 SDDV 或 MPEG2TS。 61883 协议定义数据的 1394年总线上的传输方式。 AV/C 流式处理筛选器驱动程序验证和缓存的数据格式、 查询从目标设备，即插即用的信息，如可用的同步资源并为流式处理请求的队列数据分配所需的资源。

**请注意**  :在 Windows XP Service Pack 2 (SP2) 之前*Avcstrm.sys*只能使用目标设备的第一个 （索引 0） 等时即插即用句柄来建立的连接。 此限制受限制的 AV/C 的设备 （和因此其驱动程序） 与多个子单元在同时支持多个流。 在 Windows XP SP2 和更高版本，但是， *Avcstrm.sys*自动选择的 AV/C 设备等时即插即用句柄，从最低索引开始，然后向上，以使设备能够支持多个流已更改同时。
因为连接是从最低索引及更高的子单元即插即用到 AV/C 单元的内部连接等时即插即用必须遵循相同的顺序。 AV/C 的设备只有一个子单元或具有只有一个等时即插即用，设备不受影响。

 

成功创建流，则返回的流上下文。 此上下文是指向包含有关当前流，例如数据格式和流状态信息的不透明结构。

创建一个流后，可以开始的子单元驱动程序发送流数据请求。 此请求将排队等候，并将分配并提交到单独的 IRP*是 61883.sys*用于接收数据或数据传输。 完成后数据请求，将调用完成例程。 此请求是异步的因为数据传输控制流状态和数据的可用性。

流数据请求到达时，该流可以有已暂停或运行状态。 在暂停的流状态中建立同步连接。 *Avcstrm.sys*然后请求*是 61883.sys*分配带宽和同步通道，如有需要和然后过渡到运行的流状态。

将停止数据流，在转换到停止状态。 AV/C 流式处理筛选器驱动程序将通过请求 61883 要分离的数据缓冲区来回收数据缓冲区的所有权。 这些数据缓冲区将完成，状态\_已取消。

流可能需要如果调度 IOCTL 的线程已终止事件，如惊讶设备删除或数据 IRP 取消，过程中中止。 在转换到停止状态时，AV/C 流式处理筛选器驱动程序将停止同步数据传输，但不是会更改流状态。

作为筛选器驱动程序， *Avcstrm.sys*筛选器，然后仅 I/O 请求数据包 (IRP) 使用处理**MajorFunction**的 IRP\_MJ\_内部\_设备\_控件和 I/O 控制 (IOCTL) 代码的 IOCTL\_AVCSTRM\_类，并通过其他 Irp 传递到较低的堆栈。 具体取决于该请求，AV/C 流式处理筛选器驱动程序处理 IRP 从其客户端，然后创建一个或多个本地分配的 Irp，若要从其较低的堆栈，61883 或 AV/C 协议驱动程序请求服务。 即使某个子单元驱动程序的 IRP 可以将请求发送到较低的堆栈，它是更安全，以创建不同的 IRP，以免类驱动程序声明 IRP 的所有权。

AV/C 流式处理筛选器驱动程序旨在与内核流式处理接口使用 61883 和 AV/C 堆栈上。 子单元驱动程序可以使用 AVStream 或 Stream 类接口。

在以下部分中，每个 AV/C 流式处理命令函数讨论了 （一些的代码示例）。 代码示例是从 Stream 基于类的子单元驱动程序。

 

 




