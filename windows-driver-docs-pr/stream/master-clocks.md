---
title: 主时钟
description: 主时钟
ms.assetid: bdd228c1-a15f-4c08-8991-299a3f2e1ee8
keywords:
- 主时钟 WDK 内核流式处理
- 同步 WDK 内核流式处理
- KSPROPERTY_STREAM_MASTERCLOCK
- 物理时间 WDK 内核流式处理
ms.date: 04/20/2017
ms.localizationpriority: medium
ms.openlocfilehash: 24681511618126434518572d67e8c4141bbaf3e7
ms.sourcegitcommit: a33b7978e22d5bb9f65ca7056f955319049a2e4c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/31/2019
ms.locfileid: "56575844"
---
# <a name="master-clocks"></a>主时钟





微型驱动程序可以将流到由其他微型驱动程序; 创建的时钟同步可将多个流同步到一个时钟。 如果 pin 使用或生成此类*主时钟*，微型驱动程序应支持[ **KSPROPERTY\_流\_MASTERCLOCK**](https://msdn.microsoft.com/library/windows/hardware/ff565713)。 客户端还可以使用此属性设置为固定的主时钟。 执行呈现和频繁地捕获操作的 pin 使用主时钟。 微型驱动程序负责释放终止时的时钟引用。

主时钟的接口是支持的方法、 属性和事件的文件对象。

针对文件对象的所有查询都都只在被动\_级别。 但是，时钟位置查询还支持通过直接函数调用指针在调度\_级别，这是有效的只要文件对象是否有效。 此直接调用必须作为一个上下文参数传递到时钟的文件对象。

通过创建请求筛选器 pin 实例上获取文件句柄，一样使用 pin 创建通过 IRP\_MJ\_创建。 请求会导致要创建的文件句柄，就像创建的文件句柄 pin，具有其自己的上下文信息。 此文件句柄然后传递回调用方，并可用于设置主时钟的内核模式筛选器。 在筛选器正在分配关系图的主时钟，pin 实例可以查询以确定它是否拥有主时钟的父文件对象。

筛选器为此主时钟授予的文件句柄，然后查询属性使用。 如果主时钟基于内核模式筛选器，它必须支持的接口来查询主时钟的内核模式部分的文件句柄。 如果不支持该接口，它将被视为时钟是基于模式的用户和内核模式下的筛选器不能同步到它。

请求的主时钟 DirectShow 代理筛选器处理，然后将其传递给其基础的内核模式筛选器的文件句柄。 内核模式筛选器引用的基础的文件对象。 如果筛选器已有主时钟，它将取消引用的文件对象并使用新的句柄。 若要执行此操作，筛选器必须处于*停止状态*。

主时钟对象上的物理时间是经常基于硬件的。 如果显示主时钟的筛选器的任何物理时钟，则流时间进度的根据提供的数据的时间戳。 在这种情况下，时间戳可能会由于缺少数据而停止。

主时钟背后的物理时间可能是远程的在这种情况下它是本地代理服务器以提供精确读数的责任。 例如，该代理具有负责延迟补偿跨 1394年连接，或在网络上平均延迟。 此外，如果某些其他内核筛选器是相同的 1394年总线上的第二个设备的代理，则两个设备可能与主时钟协商相连接的私有方法。 在这种情况下，设备必须使用专用接口来确定时钟类型，以便进行验证的兼容性。

 

 




